<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Build a Weather Station with Raspberry PI and Sourcekit Atiic - 古作坊 Agu's Mill</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-110480634-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="古作坊 Agu's Mill" rel=home><div class="logo__item logo__text"><div class=logo__title>古作坊 Agu's Mill</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Build a Weather Station with Raspberry PI and Sourcekit Atiic</h1></header><div class="content post__content clearfix"><p>Sourcekit® Atiic is an universal i2c to serial bridge. Atiic means AT commands to operate i2c devices. Check <a href=https://i2c.ninja/#/about>i2c.ninja</a> to see how its AT command sets work.</p><p><img src=atiic_rpi3b.jpg alt="Atiic and Raspberry Pi 3B"></p><p>PC - USB - USB-TTL - Atiic - i2c sensors (SPL06 and AHT21)</p><h1 id=instructions>Instructions</h1><ol><li><p>Flash an micro SD card with latest <a href=https://downloads.raspberrypi.org/raspios_lite_arm64/images/raspios_lite_arm64-2022-04-07/2022-04-04-raspios-bullseye-arm64-lite.img.xz>64-bit Raspberry OS Lite</a> and get it running, Raspberry Pi 3B (RAM 1GB) should be enough in this application.</p></li><li><p>Install docker, reference: <a href=https://docs.docker.com/engine/install/debian/>https://docs.docker.com/engine/install/debian/</a></p><ol><li>sudo usermod -a -G docker pi</li><li>append <code>cgroup_enable=memory</code> in <code>/boot/cmdline.txt</code></li><li>system reboot</li></ol></li><li><p>Install grafana-oss</p><ol><li>sudo mkdir -p /var/lib/grafana /var/lib/atiic</li><li>sudo chown 472 /var/lib/grafana</li><li>docker run -d -p 3000:3000 -v /var/lib/grafana:/var/lib/grafana -v /var/lib/atiic:/var/lib/atiic:ro &ndash;name=grafana &ndash;restart=unless-stopped grafana/grafana-oss:8.5.0</li></ol></li><li><p>Install aguegu/Atiic</p></li></ol><p>docker run -d &ndash;name=atiic &ndash;restart=unless-stopped &ndash;privileged=true -v /var/lib/atiic:/var/lib/atiic -v /dev:/dev -v /run/udev:/run/udev:ro aguegu/atiic:develop-arm64v8</p><ol start=5><li><p>Configure grafana</p><ol><li>Visit http://:3000 and login with admin/admin</li><li>In menu <code>Server Admin / Plugins</code> install <code>sqlite</code></li><li>Configure a SQLite datasource, and click <code>Save & Test</code><ul><li>Name: Atiic</li><li>Path: /var/lib/atiic/database.SQLite</li></ul></li><li>Go to menu <code>Dashboards</code> and create an new Dashboard</li><li>Create a dashboard with SQL:</li></ol><pre tabindex=0><code>SELECT avg(aht21Humidity), max(ts) as _ts FROM atiic WHERE ts &gt;= ${__from:date:seconds} AND ts &lt; ${__to:date:seconds} group by (1000*ts/$__interval_ms)
</code></pre></li><li><p>Tweak the dashboard to the style you prefer</p></li></ol><p><img src=screenshot.png alt=screenshot></p><p>There are 6 fields in the <code>atiic</code> table:</p><ul><li>ts: INTEGER PRIMARY KEY, unix timestamp in seconds</li><li>spl06Temperature: REAL, Temperature reading from SPL06, unit Celsius (°C)</li><li>spl06Pressure: REAL, Air Pressure reading from SPL06, unit Pascal (Pa)</li><li>aht21Temperature: REAL, Temperature reading from AHT21, unit Celsius (°C)</li><li>aht21Humidity: REAL, Relative Humidity reading from AHT21, unit 100%</li><li>ttl: INTEGER, measurement duration, unit milliseconds (ms)</li></ul></div></article></main><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//agus-mill.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 古作坊 Agu's Mill.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>